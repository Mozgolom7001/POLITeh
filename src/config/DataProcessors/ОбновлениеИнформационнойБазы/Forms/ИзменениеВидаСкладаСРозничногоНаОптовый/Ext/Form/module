// Процедура заполняет список складов на основании движений регистра "ТоварыНаСкладах"
//
Процедура ЗаполнитьСписокСкладов()
	
	СписокСкладов.Очистить();
	
	ТекстЗапроса =
		"ВЫБРАТЬ РАЗРЕШЕННЫЕ РАЗЛИЧНЫЕ
		|	ТоварыНаСкладах.Склад,
		|	ПРЕДСТАВЛЕНИЕ(ТоварыНаСкладах.Склад) КАК ПредставлениеСклада
		|ИЗ
		|	РегистрНакопления.ТоварыНаСкладах КАК ТоварыНаСкладах
		|ГДЕ
		|	Склад.ВидСклада = &ВидСкладаРозничный
		|УПОРЯДОЧИТЬ ПО
		|	ТоварыНаСкладах.Склад.Наименование";
	
	Запрос = Новый Запрос;
	Запрос.Текст = ТекстЗапроса;
	Запрос.УстановитьПараметр( "ВидСкладаРозничный", Перечисления.ВидыСкладов.Розничный);
	
	Результат = Запрос.Выполнить();
	Если Результат.Пустой() Тогда
		СообщитьОСостоянииОбновления("","Нет данных для заполнения");
		Возврат;
	КонецЕсли;
	
	Обход = Результат.Выбрать();
	Пока Обход.Следующий() Цикл
		СписокСкладов.Добавить(Обход.Склад, Обход.ПредставлениеСклада);
	КонецЦикла;
	
КонецПроцедуры // ЗаполнитьСписокСкладов()

Процедура КоманднаяПанель1Заполнить(Кнопка)

	ЗаполнитьСписокСкладов();
	
КонецПроцедуры

Процедура СписокСкладовВыбор(Элемент, ЭлементСписка)

	Если НЕ Элемент.ТекущаяСтрока = Неопределено Тогда
		Форма = Элемент.ТекущаяСтрока.Значение.ПолучитьФорму(, ЭтаФорма, ЭтаФорма);
		Форма.Открыть();
	КонецЕсли;
	
КонецПроцедуры

Процедура КнопкаВыполнитьНажатие(Кнопка)
    ВыполнитьОбработку(истина);
	
КонецПроцедуры

Процедура ПередОткрытием(Отказ, СтандартнаяОбработка)
	
	Отказ = не ПолучитьРазрешениеНаОткрытиеФормы();
	
КонецПроцедуры

Процедура ПриОткрытии()

	ЗаполнитьСписокСкладов();
	
КонецПроцедуры // ПриОткрытии()

Процедура ВыполнитьОбработку(флЗапускИзФормы=ложь) Экспорт
	Если не флЗапускИзФормы Тогда
		ЗаполнитьСписокСкладов();
	КонецЕсли;
	ЗаписьЖурналаРегистрации("ИнформационнаяБаза.ОбновлениеИБ", УровеньЖурналаРегистрации.Информация, ЭтотОбъект.Метаданные(), ,
	"Запущена обработка " + ЭтаФорма.Заголовок);
    СообщитьОСостоянииОбновления("","Запущен процесс изменения вида склада с розничного на оптовый");
	НачатьТранзакцию();
	
	Для Каждого ЭлемСклад Из СписокСкладов Цикл
		Объект = ЭлемСклад.Значение.ПолучитьОбъект();
		Объект.ВидСклада = Перечисления.ВидыСкладов.Оптовый;
		Объект.Комментарий = "Изменен вид склада с розничного на оптовый при обновлении конфигурации";
		Объект.ОбменДанными.Загрузка = Истина;
		Объект.Записать();
	КонецЦикла;
	
	ЗафиксироватьТранзакцию();
	СообщитьОСостоянииОбновления("","Завершен процесс изменения вида склада с розничного на оптовый");

    ЗаписьЖурналаРегистрации("ИнформационнаяБаза.ОбновлениеИБ", УровеньЖурналаРегистрации.Информация, ЭтотОбъект.Метаданные(), ,
	"Выполнена обработка " + ЭтаФорма.Заголовок);

КонецПроцедуры

