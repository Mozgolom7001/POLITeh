
// Процедура - обаботчик события "ПередОткрытием" Формы
//
Процедура ПередОткрытием(Отказ, СтандартнаяОбработка)
	
	ПостроительОтчета.Текст = 
	"ВЫБРАТЬ
	|	ВложенныйЗапрос.Номенклатура КАК Номенклатура,
	|	ВложенныйЗапрос.ХарактеристикаНоменклатуры КАК ХарактеристикаНоменклатуры
	|ИЗ
	|	(ВЫБРАТЬ
	|		Номенклатура.Ссылка КАК Номенклатура,
	|		&ПустаяХарактеристикаНоменклатуры КАК ХарактеристикаНоменклатуры
	|	ИЗ
	|		Справочник.Номенклатура КАК Номенклатура
	|	ГДЕ
	|		(НЕ Номенклатура.ЭтоГруппа)
	|	
	|	ОБЪЕДИНИТЬ ВСЕ
	|	
	|	ВЫБРАТЬ
	|		ХарактеристикиНоменклатуры.Владелец,
	|		ХарактеристикиНоменклатуры.Ссылка
	|	ИЗ
	|		Справочник.ХарактеристикиНоменклатуры КАК ХарактеристикиНоменклатуры
	|	ГДЕ
	|		(НЕ ХарактеристикиНоменклатуры.Владелец.ЭтоГруппа)
	|		И ХарактеристикиНоменклатуры.Владелец.ВестиУчетПоХарактеристикам) КАК ВложенныйЗапрос
	|
	|УПОРЯДОЧИТЬ ПО
	|	Номенклатура,
	|	ХарактеристикаНоменклатуры";
	
	ПостроительОтчета.Параметры.Вставить("ПустаяХарактеристикаНоменклатуры", Справочники.ХарактеристикиНоменклатуры.ПустаяСсылка());
	ПостроительОтчета.ЗаполнитьНастройки();
	//Настройки = ВосстановитьЗначение("ЭлектронныйДокументИсходящий.ФормаЗаполненияНоменклатуры.НастройкиПостроителя");
	//Если Не Настройки = Неопределено Тогда
	//	ПостроительОтчета.УстановитьНастройки(Настройки);
	//Иначе
		Отбор = ПостроительОтчета.Отбор.Добавить("Номенклатура");
		Отбор.ВидСравнения = ВидСравнения.ВИерархии;
		
		Отбор = ПостроительОтчета.Отбор.Добавить("Номенклатура.ПометкаУдаления");
		Отбор.Установить(Ложь);
		
	//КонецЕсли;
	
КонецПроцедуры

// Процедура - обаботчик события, при нажатии на кнопку "ОК" Командной панели "ОсновныеДействияФормы"
//
Процедура ОсновныеДействияФормыОК(Кнопка)
	
	ПостроительОтчета.Выполнить();
	Настройки = ПостроительОтчета.ПолучитьНастройки(Истина, Ложь, Ложь, Ложь, Ложь);
	СохранитьЗначение("ЭлектронныйДокументИсходящий.ФормаЗаполненияНоменклатуры.НастройкиПостроителя", Настройки);
	Закрыть(ПостроительОтчета.Результат.Выгрузить());
	
КонецПроцедуры

