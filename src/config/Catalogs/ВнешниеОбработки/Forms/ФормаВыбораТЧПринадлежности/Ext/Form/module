Процедура ЗаполнитьСписокОбъектов()
    ЕСли УжеВыбранные = Неопределено  Тогда
		УжеВыбранные = Новый Соответствие;
	КонецЕсли;
	
	Если СсылкаОбъекта <> Неопределено Тогда
		
		СписокТабЧастей = ПолучитьСписокТабличныхЧастей();
			
		Для Каждого ТабличнаяЧасть Из СписокТабЧастей Цикл
			Если УжеВыбранные[ТабличнаяЧасть.Значение] = Неопределено Тогда
				СписокТабличныхЧастей.Добавить(ТабличнаяЧасть.Значение, ТабличнаяЧасть.Представление);
			КонецЕсли;
		КонецЦикла;
		
	КонецЕсли;
КонецПроцедуры

Процедура ПередОткрытием(Отказ, СтандартнаяОбработка)
	ЗаполнитьСписокОбъектов();
КонецПроцедуры

Процедура ОсновныеДействияФормыКнопкаОК(Кнопка)	
	ОповеститьОВыборе(ЭлементыФормы.СписокТабличныхЧастей.ТекущаяСтрока);
КонецПроцедуры

Процедура СписокДокументовВыбор(Элемент, ВыбраннаяСтрока, Колонка, СтандартнаяОбработка)
	ОповеститьОВыборе(ЭлементыФормы.СписокТабличныхЧастей.ТекущаяСтрока);
КонецПроцедуры

Процедура ПриПовторномОткрытии(СтандартнаяОбработка)
	ЗаполнитьСписокОбъектов(); 
КонецПроцедуры

Функция ПолучитьСписокТабличныхЧастей()

	Объект = Неопределено;
	
	Если Документы.ТипВсеСсылки().СодержитТип(ТипЗнч(СсылкаОбъекта)) Тогда
		Объект = Документы[СсылкаОбъекта.Метаданные().Имя].СоздатьДокумент();
	ИначеЕсли Справочники.ТипВсеСсылки().СодержитТип(ТипЗнч(СсылкаОбъекта)) Тогда
		Объект = Справочники[СсылкаОбъекта.Метаданные().Имя].СоздатьЭлемент();
	КонецЕсли; 
	
	Если Объект <> Неопределено Тогда
		Попытка
			Возврат Объект.ПолучитьТабличныеЧастиДляЗаполнения();
		Исключение
		КонецПопытки;
	КонецЕсли;
	
	СписокТабЧастей = Новый СписокЗначений;
	
	Для Каждого ТабличнаяЧасть Из СсылкаОбъекта.Метаданные().ТабличныеЧасти Цикл
		СписокТабЧастей.Добавить(ТабличнаяЧасть.Имя, ТабличнаяЧасть.Синоним);
	КонецЦикла;
	
	Возврат СписокТабЧастей;
	
КонецФункции

